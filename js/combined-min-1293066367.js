/*
 * appHelp v1.0
 *
 * Copyright 2010, Johannes Koggdal
 * http://koggdal.com/
 */
(function(e,b,g){var a,f,d,c=false;a=f=function(h){return new d(h)};d=function(h){var m;this.touch_enabled=g;this.animating=[];if(typeof h==="string"){m=this.nodeListToArray(b.querySelectorAll(h))}else{if(h.length&&h.length>0){m=h}else{m=[h]}}for(var k=0,j=m.length;k<j;k++){this.animating.push(false)}if(m!==null&&m!==g){this.elements=m}return this};d.prototype=a.fn={get:function(h){return this.elements[h]},find:function(h){var o=[];for(var m=0,j=this.elements.length;m<j;m++){var n=this.elements[m],k=this.nodeListToArray(n.querySelectorAll(h));o=o.concat(k)}return f(o)},nodeListToArray:function(k){var j=[];for(var m=0,h=k.length;m<h;m++){j.push(k[m])}return j},alert:function(j){var i="";if(typeof j==="object"&&j.nodeType===g){for(var h in j){i+=h+" : "+j[h]+"\n"}}else{if(typeof j==="string"){i=j}}alert(i)},bind:function(s,t){for(var j=0,r=this.elements.length;j<r;j++){var k=this.elements[j];var u=s.split(" ");for(var p=0,m=u.length;p<m;p++){if(u[p]=="touchclick"){doc_pointerup=function(i){if(f.isTouchDevice(i)&&~i.type.indexOf("mouse")){return false}c=false};var q=this,h=function(i){if(f.isTouchDevice(i)&&~i.type.indexOf("mouse")){return false}c=true;if(k!==b){b.addEventListener("touchend",doc_pointerup,false);b.addEventListener("mouseup",doc_pointerup,false)}},o=function(n,i){if(f.isTouchDevice(n)&&~n.type.indexOf("mouse")){return false}var v=f.getPos(n,0),l=this===b?{top:0,right:e.innerWidth,bottom:e.innerHeight,left:0}:this.getBoundingClientRect();if(c&&v.x>=l.left&&v.x<=l.right&&v.y>l.top&&v.y<l.bottom){if(k!==b){b.removeEventListener("touchend",doc_pointerup,false);b.removeEventListener("mouseup",doc_pointerup,false)}c=false;t.call(this,n,i)}};k.addEventListener("touchstart",h,false);k.addEventListener("mousedown",h,false);k.addEventListener("touchend",(function(i){return function(l){o.call(this,l,i)}})(j),false);k.addEventListener("mouseup",(function(i){return function(l){o.call(this,l,i)}})(j),false)}else{k.addEventListener(u[p],t,false)}}}return this},unbind:function(k,m){for(var j=0,h=this.elements.length;j<h;j++){var n=this.elements[j];k=k.split(" ");for(var j=0,h=k.length;j<h;j++){n.removeEventListener(k[j],m,false)}}return this},isTouchDevice:function(h){if(this.touch_enabled===g||this.touch_enabled===false){this.touch_enabled=!!h.touches}return this.touch_enabled},extend:function(j,i){for(var h in i){if(typeof i[h]==="object"&&i[h].length===g&&i[h].nodeType===g){f.extend(j[h],i[h])}else{j[h]=i[h]}}return j},getPos:function(k,j,i){j=j||0;var m=i?i.getBoundingClientRect():(this.elements?this.elements[0].getBoundingClientRect():{top:0,right:0,bottom:0,left:0}),l={x:k.touches?(k.touches.length>0?k.touches[j].clientX:k.changedTouches[j].clientX):k.clientX,y:k.touches?(k.touches.length>0?k.touches[j].clientY:k.changedTouches[j].clientY):k.clientY,},h={x:e.scrollX,y:e.scrollY},n={x:l.x-m.left-h.x,y:l.y-m.top-h.y};return n},isHidden:function(){var j=this.elements[0],i=e.getComputedStyle(j,null),h=i.getPropertyValue("visibility"),k=i.getPropertyValue("display");if(k=="none"||h=="hidden"){return true}else{return false}},hide:function(){for(var j=0,h=this.elements.length;j<h;j++){var k=this.elements[j];if(k.getAttribute("data-olddisplay")==""){k.setAttribute("data-olddisplay",k.style.display==""?"block":k.style.display)}k.style.display="none"}return this},show:function(){for(var j=0,h=this.elements.length;j<h;j++){var m=this.elements[j],k=m.getAttribute("data-olddisplay")||"block";oldVisibility=m.getAttribute("data-oldvisibility")||"visible";m.style.display=k;m.style.visibility=oldVisibility}return this},hasClass:function(h){var i=this.elements[0];if(i.classList!==g){return i.classList.contains(h)}else{if(~(" "+i.className+" ").indexOf(" "+h+" ")){return true}else{return false}}},addClass:function(m){for(var k=0,h=this.elements.length;k<h;k++){var n=this.elements[k];if(n.classList!==g){n.classList.add(m)}else{var j=n.className;if(!~j.indexOf(m)){n.className=j.length>0?j+" "+m:m}}}return this},removeClass:function(m){for(var k=0,h=this.elements.length;k<h;k++){var n=this.elements[k];if(n.classList!==g){n.classList.remove(m)}else{var j=n.className,o=new RegExp(m,"g");n.className=j.replace(o,"")}}return this},remove:function(){for(var j=0,h=this.elements.length;j<h;j++){var i=this.elements[j];i.parentNode.removeChild(i)}},getStyle:function(i){var h=this.elements[0];return e.getComputedStyle(h,null).getPropertyValue(i)},animate:function(s,h,j,p){h=h||1000;j=j||30;p=p||function(){};for(var A=0,F=this.elements.length;A<F;A++){var H=this.elements[A];if(this.animating[A]){continue}var D=this,o="",u=[],k=[],z=[],I=[],w=Math.ceil(h*(j/1000)),x=1,G,C=H.style.WebkitTransitionProperty!==g,t=H.style.MozTransitionProperty!==g,v=H.style.OTransitionProperty!==g,y=function(l){var i={opacity:"",_default:"px"};if(i[l]!==g){return i[l]}else{return i._default}};for(var r in s){o+=r+", ";u.push(r);k.push(parseFloat(s[r]));z.push(parseFloat(this.getStyle(r)));I.push(Math.round((k[k.length-1]-z[z.length-1])/w*100)/100)}o=o.substring(0,o.length-2);if(C||t||v){if(C){H.style.WebkitTransitionProperty=o;H.style.WebkitTransitionDuration=h+"ms"}else{if(t){H.style.MozTransitionProperty=o;H.style.MozTransitionDuration=h+"ms"}else{if(v){H.style.OTransitionProperty=o;H.style.OTransitionDuration=h+"ms"}}}for(var E=0,B=u.length;E<B;E++){H.style[u[E]]=k[E]+y(u[E])}this.animating[A]=true;var m=setTimeout(function(){q()},h);var q=(function(i){return function(l){clearTimeout(m);D.animating[i]=false;f(H).unbind("webkitTransitionEnd oTransitionEnd transitionend",q,false);p()}})(A);f(H).bind("webkitTransitionEnd oTransitionEnd transitionend",q,false)}else{this.animating[A]=true;G=function(n){for(var K=0,J=u.length;K<J;K++){H.style[u[K]]=(z[K]+I[K]*x)+y(u[K])}x++;if(x<=w){setTimeout(G,1000/j,n)}else{for(var K=0,J=u.length;K<J;K++){H.style[u[K]]=(k[K])+y(u[K])}D.animating[n]=false;p()}};G(A)}}},ajax:function(h){var i={url:"",data:"",type:"GET",success:function(){},failure:function(){}};i=f.extend(i,h);var j=new XMLHttpRequest();if(i.type=="GET"){i.data=i.data.length>0?"?"+i.data:"";j.open(i.type,i.url+i.data);j.send(null)}else{j.open(i.type,i.url);j.setRequestHeader("Content-type","application/x-www-form-urlencoded");j.send(i.data)}j.onreadystatechange=function(){if(this.readyState==4&&this.status==200){i.success(this.responseText)}else{i.failure(this.status,this.readyState)}}}};f.alert=d.prototype.alert;f.isTouchDevice=d.prototype.isTouchDevice;f.extend=d.prototype.extend;f.getPos=d.prototype.getPos;f.getStyle=d.prototype.getStyle;f.ajax=d.prototype.ajax;e.appHelp=e.$=a})(window,window.document);
/*
 * Slider v1.0
 * appHelp Plugin
 *
 * Copyright 2010, Johannes Koggdal
 * http://koggdal.com/
 */
(function(b,a,c,d){c.fn.slider=function(o){var g={min:1,max:10,start:1,begin:function(p){},change:function(p){},end:function(p){}},e=this.get(0),i=e.firstElementChild,m=i.firstElementChild,l=parseInt(b.getComputedStyle(i,null).getPropertyValue("width")),f=false,k,h,n,j;c.extend(g,o);j=function(q){if(q.type===d){n=~~q;m.style.left=Math.floor(n/(g.max-g.min)*l)+"px"}else{var p=c.getPos(q,0,i).x;if(p<=0){m.style.left="0px";n=g.min}else{if(p>l){m.style.left=l+"px";n=g.max}else{m.style.left=p+"px";n=Math.ceil(p/l*(g.max-g.min));if(n<=g.min){n=g.min}else{if(n>g.max){n=g.max}}}}}g.change(n)};j(g.start);k=function(p){if(c.isTouchDevice(p)&&~p.type.indexOf("mouse")){return false}if(f){j(p)}};h=function(p){if(c.isTouchDevice(p)&&~p.type.indexOf("mouse")){return false}if(f){f=false;g.end();c(a).unbind("touchmove mousemove",k).unbind("touchend mouseup",h)}};c(e).bind("touchstart mousedown",function(p){if(c.isTouchDevice(p)&&~p.type.indexOf("mouse")){return false}p.preventDefault();id=p.touches?p.touches[p.touches.length-1].identifier:"mouse";f=true;g.begin();j(p);c(a).bind("touchmove mousemove",k).bind("touchend mouseup",h)});return function(p){j(p)}}})(window,window.document,appHelp);
/*
 * ColorPicker v1.0
 * appHelp Plugin
 *
 * Copyright 2010, Johannes Koggdal
 * http://koggdal.com/
 */
(function(b,a,c,d){c.fn.colorPicker=function(g){var u={startValue:175,addSwatch_cb:function(x){},change:function(x){}};c.extend(u,g);var m={r:0,g:0,b:0},f={x:299,y:0},j={red:0,green:0,blue:0},s=1,l=this.find(".colorspace").get(0),h=this.find(".colorspace .marker").get(0),w=this.find(".spectrum").get(0),q=this.find(".add-swatch").get(0),o=parseInt(b.getComputedStyle(w,null).getPropertyValue("width")),t=false,k=false,i,p=function(H,G,D){H=H/299*255;G=G/299*255;var E=H/255,A=255-G,B=1-D.red/255,I=1-D.green/255,J=1-D.blue/255,z=Math.round((1-B*E)*A),C=Math.round((1-I*E)*A),F=Math.round((1-J*E)*A);return{red:z,green:C,blue:F}},n=function(x){var z,y;if(x===d){z=f}else{z=c.getPos(x,0,l)}if(z.x>300||z.y>300||z.x<0||z.y<0){return false}h.style.left=z.x+"px";h.style.top=z.y+"px";y=p(z.x,z.y,m);f={x:z.x,y:z.y};j={red:y.red,green:y.green,blue:y.blue};u.change(j)},v=function(x){if(c.isTouchDevice(x)&&~x.type.indexOf("mouse")){return false}if(t){n(x)}},r=function(x){if(c.isTouchDevice(x)&&~x.type.indexOf("mouse")){return false}if(t){t=false;c(a).unbind("touchend mouseup",r)}};c(l).bind("touchstart mousedown",function(x){if(c.isTouchDevice(x)&&~x.type.indexOf("mouse")){return false}x.preventDefault();t=true;n(x);c(a).bind("touchend mouseup",r)}).bind("touchmove mousemove",v);var e=c(w).slider({min:1,max:299,start:u.startValue,change:function(E){var z=E,y=o/6,C=Math.ceil(E/y),B=z%y,F=(255/y)*B,G=(255-F),x=Math.round(z<y?255:z<y*2?G:z<y*4?0:z<y*5?F:255),A=Math.round(z<y?F:z<y*3?255:z<y*4?G:0),D=Math.round(z<y*2?0:z<y*3?F:z<y*5?255:G);s=E;m={red:x,green:A,blue:D};l.style.background="rgb("+x+","+A+","+D+")";n()}});c(q).bind("touchclick",function(x){u.addSwatch_cb(j,f,m,s)});return function(y,x){f=y;s=x;e(s)}}})(window,window.document,appHelp);
/*
 * Draw v1.0
 * http://draw.koggdal.com/
 *
 * Copyright 2010, Johannes Koggdal
 * http://koggdal.com/
 */
(function(b,a,c,e){var d=function(){this.settings={canvas:a.createElement("canvas"),change:function(){},width:b.innerWidth,height:b.innerHeight,hideToolbars:function(){},showToolbars:function(){},toolbars_visible:false,historyLimit:3,background:"#ffffff",density:0.66,lineWidth:2,strokeStyle:"#000000",fillStyle:"rgba(120,0,0,0.1)",opacity:1,alpha:1};this.history=[];this.historyPos=0;this.pointers={};this.activePointers=0;this.twofinger_tap=false};d.fn=d.prototype={setup:function(f){var g=this;c.extend(this.settings,f);this.canvas=this.settings.canvas;this.context=this.canvas.getContext("2d");setTimeout(function(){g.initDraw()},1);c(a).bind("touchend mouseup",function(h){g.drawEnd(h)});c(this.canvas).bind("touchstart mousedown",function(h){g.drawStart(h)}).bind("touchmove mousemove",function(h){g.drawMove(h)}).bind("touchend mouseup",function(h){g.drawEnd(h)});c(b).bind("unload",function(){g.history=null})},initDraw:function(){this.canvas.width=this.settings.width;this.canvas.height=this.settings.height;this.clear();this.reset()},drawStart:function(g){if(c.isTouchDevice(g)&&~g.type.indexOf("mouse")){return false}if(g.button&&g.button!==0){g.preventDefault();this.twofinger_tap=true;return false}this.activePointers++;for(var f=0;f<(g.touches?g.touches.length:1);f++){var h=g.touches?g.touches[f].identifier:"mouse";this.pointers[h]={enabled:true,last:{x:c.getPos(g,f,this.canvas).x,y:c.getPos(g,f,this.canvas).y}}}if(g.touches&&g.touches.length==2){this.twofinger_tap=true}else{for(var f=0;f<(g.touches?g.touches.length:1);f++){this.context.beginPath();this.context.globalAlpha=this.settings.opacity;this.context.strokeStyle=this.settings.strokeStyle;this.context.fillStyle=this.settings.fillStyle;this.context.arc(this.pointers[h].last.x,this.pointers[h].last.y,this.settings.lineWidth/2,0,Math.PI*2,false);this.context.fill();this.context.closePath()}}},drawMove:function(m){if(c.isTouchDevice(m)&&~m.type.indexOf("mouse")){return false}if(m.button&&m.button!==0||this.activePointers==0){return false}if(this.twofinger_tap){this.twofinger_tap=false}var k=m.touches?m.touches.length:1;for(var l=0;l<k;l++){var g=m.touches?m.touches[l].identifier:"mouse",f=this.pointers[g];if(f.enabled){var r=c.getPos(m,l,this.canvas),t=f.last,o={x:r.x-t.x,y:r.y-t.y,},s=t.x,q=t.y,p,j;o.d=Math.sqrt(o.x*o.x+o.y*o.y);p=o.d*this.settings.density;j=1/p;o.x*=j;o.y*=j;for(var h=0;h<p;h++){this.context.beginPath();this.context.globalAlpha=this.settings.opacity;this.context.strokeStyle=this.settings.strokeStyle;this.context.fillStyle=this.settings.fillStyle;this.context.arc(s,q,this.settings.lineWidth/2,0,Math.PI*2,false);this.context.fill();this.context.closePath();s+=o.x;q+=o.y}this.pointers[g].last.x=r.x;this.pointers[g].last.y=r.y}}},drawEnd:function(n){var k=Math.random();if(c.isTouchDevice(n)&&~n.type.indexOf("mouse")){return false}if(this.twofinger_tap){if(this.settings.toolbars_visible){this.settings.hideToolbars();this.settings.toolbars_visible=false}else{this.settings.showToolbars();this.settings.toolbars_visible=true}this.twofinger_tap=false;this.activePointers=0;return false}if(n.button&&n.button!==0||this.activePointers==0){return false}this.activePointers--;var m=[];if(n.touches){for(var j=0,f=n.touches.length;j<f;j++){m.push(n.touches[j].identifier)}}else{m.push("mouse")}for(var o in this.pointers){if(m.indexOf(o)==-1){this.pointers[o].enabled=false}}if(this.historyPos<this.history.length-1){for(var h=this.historyPos+1,g=this.history.length;h<g;h++){this.history.pop()}}if(this.history.length>this.settings.historyLimit){this.history.shift()}this.history.push(this.context.getImageData(0,0,this.canvas.width,this.canvas.height));this.historyPos=this.history.length-1;this.settings.change()},undo:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.context.putImageData(this.history[--this.historyPos],0,0)},redo:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.context.putImageData(this.history[++this.historyPos],0,0)},reset:function(){this.history=[];this.historyPos=0;this.history.push(this.context.getImageData(0,0,this.canvas.width,this.canvas.height));this.settings.change()},clear:function(){this.context.fillStyle=this.settings.background;this.context.fillRect(0,0,this.settings.width,this.settings.height);this.history.push(this.context.getImageData(0,0,this.canvas.width,this.canvas.height));this.settings.change()},loadImage:function(h,f,l,i,k){i=i||false;var j=this,g=a.createElement("img");g.src=h;g.onload=function(){j.context.drawImage(g,f,l);if(i){j.reset()}else{j.history.push(j.context.getImageData(0,0,j.canvas.width,j.canvas.height));j.settings.change()}k()}},getColorValues:function(g,j){if(j=="rgba"){var i=g||this.settings.fillStyle,h=/rgba\((\d+),(\d+),(\d+),(.*?)\)/.exec(i),f={red:parseInt(h[1]),green:parseInt(h[2]),blue:parseInt(h[3]),alpha:parseFloat(h[4])}}if(j=="rgb"){var h=/rgb\((\d+),(\d+),(\d+)\)/.exec(g),f={red:parseInt(h[1]),green:parseInt(h[2]),blue:parseInt(h[3]),alpha:1}}if(j=="hex"){var h=/#([A-Za-z0-9]{2})([A-Za-z0-9]{2})([A-Za-z0-9]{2})/.exec(g),f={red:h[1],green:h[2],blue:h[3],alpha:1}}return f},convertColorFormat:function(g,l,m){if(l=="rgba"&&m=="hex"){var k=function(r){var q={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:"a",11:"b",12:"c",13:"d",14:"e",15:"f"},p=q[Math.floor(r/16)],o=q[r%16],n=p+""+o;return n},f=this.getColorValues(g,"rgba"),j={red:k(f.red),green:k(f.green),blue:k(f.blue)};return"#"+j.red+j.green+j.blue}if(l=="hex"&&m=="rgba"){var i=function(r){var q={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15},o=q[r[0]]*16,n=q[r[1]],p=o+n;return p},f=this.getColorValues(g,"hex"),h={red:i(f.red),green:i(f.green),blue:i(f.blue),alpha:f.alpha};return"rgba("+h.red+","+h.green+","+h.blue+","+h.alpha+")"}if(l=="rgb"&&m=="rgba"){var f=this.getColorValues(g,"rgb");return"rgba("+f.red+","+f.green+","+f.blue+","+f.alpha+")"}},setBrushOpacity:function(l){var k=this.settings.fillStyle,h=/rgba\((\d+),(\d+),(\d+),.*?\)/.exec(k),j=parseInt(h[1]),i=parseInt(h[2]),f=parseInt(h[3]),g=(l/100)*(1/this.settings.lineWidth);this.settings.fillStyle="rgba("+j+","+i+","+f+","+g+")";this.settings.alpha=l},setBrushColor:function(f){if(f.indexOf("#")>-1){f=this.convertColorFormat(f,"hex","rgba")}else{if(f.indexOf("rgb(")>-1){f=this.convertColorFormat(f,"rgb","rgba")}}this.settings.fillStyle=f;this.setBrushOpacity(this.settings.alpha)},setBrushSize:function(f){this.settings.lineWidth=f;if(f==1){this.settings.density=1}else{this.settings.density=0.66}}};b.Draw=d})(window,window.document,appHelp);
/*
 * DrawApp v1.0
 * http://draw.koggdal.com/
 *
 * Copyright 2010, Johannes Koggdal
 * http://koggdal.com/
 */
(function(ab,h,Q,t){Q(h).bind("touchmove",function(ao){ao.preventDefault()});Q(h).bind("touchstart",function(ao){ao.preventDefault()});var am=new Draw(),V=Q("#app_header"),q=Q("#app_footer"),ai=Q("#header_home .edit"),y=Q("#header_home .login"),l=Q("#home .login_box"),d=Q("#home .login_box #email"),aj=Q("#home .login_box #password"),E=Q("#home .login_box button"),al,C,j=Q("#home .new"),H=Q("#color"),w={wrapper:Q("#colorpicker"),message:Q("#colorpicker .message"),space:Q("#colorpicker .colorspace"),spectrum:Q("#colorpicker .spectrum"),addSwatch:Q("#colorpicker .add-swatch")},c=Q("#swatches .colorbox").elements,X=[],O={},J,z={wrapper:Q("#size"),bg:Q("#size .slider-bg"),handle:Q("#size .slider-handle")},g,U={wrapper:Q("#opacity"),bg:Q("#opacity .slider-bg"),handle:Q("#opacity .slider-handle")},A,af=Q(".home"),k=Q(".undo"),an=Q(".redo"),e=Q(".save"),T=Q(".save_box"),ae=0,s=Q(".save_local"),S=Q(".save_cloud"),Y=Q(".save_cancel"),p=Q(".cloud_info .register_button"),ah=Q(".cloud_info .login_button"),D=Q(".cloud_info .back_button"),ac=Q(".cloud_register .back_button"),b=Q(".cloud_register .register_button"),m=Q(".cloud_login .back_button"),f=Q(".cloud_login .login_button"),R=false,B=0,P=Q("#home .grid .image"),v=Q("#home .grid"),r=1,Z=[],aa="unsaved",W=false,G,ak,I,N=1,n=Q("#draw .message"),L,ag,a,x=Q("#draw .toolbar_wrapper"),i=Q("#draw .brush_size"),o=false;init=function(){for(var at=0;at<c.length;at++){X.push(false)}am.setup({canvas:Q("#stage").get(0),change:function(){if(am.history.length>1){k.removeClass("disabled");an.addClass("disabled");ae++}else{k.addClass("disabled");an.addClass("disabled");ae=0}},historyLimit:10,hideToolbars:function(){V.hide();q.hide()},showToolbars:function(){V.show();q.show()},toolbars_visible:true});x.get(0).style.height=(ab.innerHeight-52-129)+"px";var ar=function(au){am.setBrushColor(au);H.get(0).style.background=au;H.get(0).style.WebkitBackgroundClip="padding-box"};var ap=w.wrapper.colorPicker({startValue:170,change:function(au){ar("rgb("+au.red+","+au.green+","+au.blue+")")},addSwatch_cb:function(av,aw,az,au){for(var ax=0;ax<c.length;ax++){if(X[ax]===false){c[ax].style.background="rgb("+av.red+","+av.green+","+av.blue+")";c[ax].style.WebkitBackgroundClip="padding-box";Q(c[ax]).addClass("filled");X[ax]={color:av,shadingPosition:aw,baseColor:az,sliderPosition:au};break}else{if(ax==c.length-1){w.message.show();for(var ay=0;ay<c.length;ay++){Q(c[ay]).addClass("highlighted")}O={color:av,shadingPosition:aw,baseColor:az,sliderPosition:au};J=function(aA){if(Q.isTouchDevice(aA)&&~aA.type.indexOf("mouse")){return false}w.message.hide();for(var aB=0;aB<c.length;aB++){Q(c[aB]).removeClass("highlighted")}Q(h).unbind("touchstart mousedown",J)};Q(h).bind("touchstart mousedown",J)}}}}});H.bind("touchstart mousedown",function(au){if(Q.isTouchDevice(au)&&~au.type.indexOf("mouse")){return false}if(w.wrapper.isHidden()){w.wrapper.show()}else{w.wrapper.hide()}});for(var at=0;at<c.length;at++){(function(au){Q(c[au]).bind("touchstart mousedown",function(ax){if(Q.isTouchDevice(ax)&&~ax.type.indexOf("mouse")){return false}if(Q(c[au]).hasClass("highlighted")){var av=O.color;c[au].style.background="rgb("+av.red+","+av.green+","+av.blue+")";c[au].style.WebkitBackgroundClip="padding-box";X[au]=O}else{var aw=X[au];ap(aw.shadingPosition,aw.sliderPosition)}})})(at)}g=z.wrapper.slider({min:1,max:50,start:2,begin:function(){i.show()},change:function(au){am.setBrushSize(au);var av=i.get(0);av.style.width=au+"px";av.style.height=au+"px";av.style.top=((ab.innerHeight-52-129-au)/2+52)+"px";av.style.left=((ab.innerWidth-au)/2)+"px";av.style.background=am.settings.fillStyle},end:function(){i.hide()}});A=U.wrapper.slider({min:0,max:100,start:100,begin:function(){i.show()},change:function(au){am.setBrushOpacity(au);i.get(0).style.background=am.settings.fillStyle},end:function(){i.hide()},});af.bind("touchclick",function(au){clearTimeout(a);n.get(0).style.display="none";n.get(0).style.opacity="0";if(ae>0){L('Image has changed<br /><button type="button" class="save_yes">Save</button><button type="button" class="save_no">Don\'t save</button>');Q("#app_content .message .save_yes").bind("touchclick",function(){ag();W=true;T.animate({bottom:0},200,30)});Q("#app_content .message .save_no").bind("touchclick",function(){ag();F();h.body.setAttribute("id","mode_home")})}else{F();h.body.setAttribute("id","mode_home")}});k.bind("touchclick",function(au){am.undo();if(am.historyPos==0){k.addClass("disabled")}an.removeClass("disabled")});an.bind("touchclick",function(au){am.redo();if(am.historyPos==am.history.length-1){an.addClass("disabled")}k.removeClass("disabled")});var ao,aq;e.bind("touchclick",function(au){T.animate({bottom:0},200,30)});s.bind("touchclick",function(au){T.animate({bottom:-1*parseInt(T.getStyle("height"))},200,30);if(aa=="unsaved"){G()}else{G(N)}L("<h2>Image saved</h2>to browser storage",1500)});S.bind("touchclick",function(av){if(B>0){if(R){return false}R=true;var au=S.get(0).innerHTML;S.addClass("disabled").get(0).innerHTML="Processing...";ak(B,function(){C(B,function(){R=false;S.removeClass("disabled").get(0).innerHTML=au;T.animate({bottom:-1*parseInt(T.getStyle("height"))},200,30);L("<h2>Image saved</h2>to cloud storage",1500)})})}else{T.find(".save_choices").hide();T.find(".cloud_info").show()}});D.bind("touchclick",function(au){T.find(".cloud_info").hide();T.find(".save_choices").show()});p.bind("touchclick",function(au){T.find(".cloud_info").hide();T.find(".cloud_register").show()});ac.bind("touchclick",function(au){T.find(".cloud_register").hide();T.find(".cloud_info").show()});Q(".cloud_register").find("input, .register_button").bind("keypress touchclick click",function(ax){if(ax.type=="click"){ax.preventDefault()}else{if((this.nodeName=="INPUT"&&ax.type=="keypress"&&(ax.keyCode==13||ax.which==13))||(this.nodeName=="BUTTON"&&ax.type!="keypress")){ax.preventDefault();var aB=T.find("label[for=reg_email]").get(0),aA=T.find("label[for=reg_password_1]").get(0),ay=T.find("label[for=reg_password_2]").get(0),au=T.find("#reg_email").get(0),aw=T.find("#reg_password_1").get(0),av=T.find("#reg_password_2").get(0),az=0;aB.innerHTML="E-mail";aA.innerHTML="Password";ay.innerHTML="Password again";if(/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.(aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro|travel|mobi|[a-z][a-z])|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i.test(au.value)===false){aB.innerHTML="E-mail - <b>Incorrect address</b>";az++}if(aw.value.length<6){aA.innerHTML="Password - <b>Too short</b>";az++}if(aw.value!=av.value){ay.innerHTML="Password again - <b>Does not match</b>";az++}if(az==0){if(R){return false}R=true;Q.ajax({url:"../register/",data:"email="+au.value+"&password="+aw.value,type:"POST",success:function(aC){var aD=JSON.parse(aC);if(aD.status=="ok"){ak(aD.user.id,function(){al("save_register",function(aE){T.animate({bottom:-1*parseInt(T.getStyle("height"))},200,30,function(){au.value="";aw.value="";av.value="";T.find(".cloud_register").hide();T.find(".save_choices").show();R=false});Q("#app_header").get(0).scrollIntoView();au.blur();aw.blur();av.blur();L("<h2>Image saved</h2>to cloud storage",1500)})})}else{if(aD.status=="email-exists"){aB.innerHTML="E-mail - <b>Already exists in database</b>";R=false}}}})}}}});ah.bind("touchclick",function(au){T.find(".cloud_info").hide();T.find(".cloud_login").show()});m.bind("touchclick",function(au){T.find(".cloud_login").hide();T.find(".cloud_info").show()});Q(".cloud_login").find("input, .login_button").bind("keypress touchclick click",function(au){if(au.type=="click"){au.preventDefault()}else{if((this.nodeName=="INPUT"&&au.type=="keypress"&&(au.keyCode==13||au.which==13))||(this.nodeName=="BUTTON"&&au.type!="keypress")){au.preventDefault();if(R){return false}R=true;al("save_login",function(av){ak(av,function(){C(av,function(){T.animate({bottom:-1*parseInt(T.getStyle("height"))},200,30,function(){T.find(".cloud_login").hide();T.find(".save_choices").show();R=false});L("<h2>Image saved</h2>to cloud storage",1500)})})})}}});Y.bind("touchclick",function(au){Q(h).unbind("touchstart mousedown",ao);T.unbind("touchstart mousedown",aq);T.animate({bottom:-1*parseInt(T.getStyle("height"))},200,30)});Q(h).bind("touchstart mousedown",function(au){x.hide()});o=true};L=function(ar,aq){var ap=300;if(aq=="no-animation"){ap=0;aq=t}var ao=n.get(0);ao.innerHTML=ar;ao.style.opacity="0";ao.style.display="block";ao.style.left=((ab.innerWidth-parseInt(n.getStyle("width"))-parseInt(n.getStyle("padding-left"))-parseInt(n.getStyle("padding-right")))/2)+"px";if(ap>0){n.animate({opacity:1},ap,30,function(){if(aq!==t){a=setTimeout(function(){ag()},aq)}})}else{ao.style.opacity="1";if(aq!==t){a=setTimeout(function(){ag()},aq)}}};ag=function(){n.animate({opacity:0},500,30,function(){n.get(0).style.display="none"})};I=function(au){var ao=h.createElement("canvas"),ap=ao.getContext("2d"),aq=am.canvas.width>am.canvas.height?am.canvas.height:am.canvas.width,av=Math.abs(am.canvas.width-am.canvas.height)/2,at=am.canvas.width>am.canvas.height?av:0,ar=am.canvas.width>am.canvas.height?0:av;ao.width=88;ao.height=88;ap.drawImage(am.canvas,at,ar,aq,aq,0,0,88,88);if(au=="data_url"){return ao.toDataURL()}else{return ao}};G=function(ao){if(ao===t){ao=~~ab.localStorage.getItem("last_id")+1;ab.localStorage.setItem("last_id",ao)}ab.localStorage.setItem("image_"+ao,am.canvas.toDataURL());ab.localStorage.setItem("thumb_"+ao,I("data_url"));aa="saved";ae=0;if(W){W=false;F();h.body.setAttribute("id","mode_home")}};ak=function(ao,ap){ap=ap||function(){};Q.ajax({url:"../cloud-save/",data:"user_id="+ao+"&fullsize="+am.canvas.toDataURL()+"&thumb="+I("data_url"),type:"POST",success:function(aq){var ar=JSON.parse(aq);aa="saved";ae=0;if(W){W=false;F();h.body.setAttribute("id","mode_home")}ap()}})};ai.bind("touchclick",function(){var ao=ai.get(0);if(ao.innerHTML=="Edit"){ao.innerHTML="Done";y.hide();P.addClass("delete")}else{if(ao.innerHTML=="Done"){ao.innerHTML="Edit";y.show();P.removeClass("delete")}}});y.bind("touchclick",function(){var ao=parseInt(l.getStyle("top"));if(ao<0){if(y.get(0).innerHTML=="Log out"){Q.ajax({url:"../logout/",type:"POST",success:function(){y.get(0).innerHTML="Log in";Z=[];F();B=0;if(Q("#home .grid .active:not(.new)").elements.length==0){ai.hide();P.removeClass("delete")}}})}else{d.get(0).value=ab.localStorage.getItem("login_email");l.animate({top:0},200,30);ai.hide();y.get(0).innerHTML="Cancel"}}else{l.animate({top:-1*parseInt(l.getStyle("height"))},200,30);ai.show();l.find("input").get(0).blur();l.find("input").get(1).blur();y.get(0).innerHTML="Log in"}});var M=false;Q(".login_box input, .cloud_login input").bind("blur",function(){M=false;setTimeout(function(){if(!M){Q("#app_header").get(0).scrollIntoView()}},10)});Q(".login_box input, .cloud_login input").bind("focus",function(){M=true});C=function(ao,ap){ap=ap||function(){};Q.ajax({url:"../cloud-images/",data:"user_id="+ao,type:"GET",success:function(at){var av=JSON.parse(at);if(av.status=="ok"){Z=[];for(var au=0,aq=av.images,ar=aq.length;au<ar;au++){Z.push(aq[au])}F();ap()}}})};al=function(at,aw){aw=aw||function(){};var ao=(at=="save_login")?T.find("label[for=login_email]").get(0):((at=="save_register")?T.find("label[for=reg_email]").get(0):l.find("label[for=email]").get(0)),aq=(at=="save_login")?T.find("label[for=login_password]").get(0):((at=="save_register")?T.find("label[for=reg_password_1]").get(0):l.find("label[for=password]").get(0)),ar=(at=="save_login")?T.find("#login_email").get(0):((at=="save_register")?T.find("#reg_email").get(0):d.get(0)),av=(at=="save_login")?T.find("#login_password").get(0):((at=="save_register")?T.find("#reg_password_1").get(0):aj.get(0)),ap=(at=="save_login")?f:((at=="save_register")?b:false),au=(at=="save_login")?m:((at=="save_register")?ac:false);if(ap!==false){var ax=ap.get(0).innerHTML;ap.addClass("disabled").get(0).innerHTML="Processing...";au.addClass("disabled")}Q.ajax({url:"../login/",data:"email="+ar.value+"&password="+av.value,type:"POST",success:function(ay){var aA=JSON.parse(ay),az=aA.user?aA.user.id:0;ao.innerHTML="E-mail";aq.innerHTML="Password";if(aA.status=="ok"){ab.localStorage.setItem("login_email",aA.user.email);y.get(0).innerHTML="Log out";B=aA.user.id;if(at=="header"){l.animate({top:-1*parseInt(l.getStyle("height"))},200,30)}av.value="";ar.blur();av.blur();C(aA.user.id,function(){if(ap!==false){ap.removeClass("disabled").get(0).innerHTML=ax;au.removeClass("disabled")}if(Q("#home .grid .active:not(.new)").elements.length>0){ai.show()}aw(aA.user.id)})}else{if(aA.status=="wrong-email"){ao.innerHTML="E-mail - <b>Address not found</b>";ao.scrollIntoView(false);if(ap!==false){ap.removeClass("disabled").get(0).innerHTML=ax;au.removeClass("disabled")}}else{if(aA.status=="wrong-password"){aq.innerHTML="Password - <b>Not correct</b>";if(ap!==false){ap.removeClass("disabled").get(0).innerHTML=ax;au.removeClass("disabled")}}}}}})};l.find("input, button").bind("keypress touchclick click",function(ao){if(ao.type=="click"){ao.preventDefault()}else{if((this.nodeName=="INPUT"&&ao.type=="keypress"&&(ao.keyCode==13||ao.which==13))||(this.nodeName=="BUTTON"&&ao.type!="keypress")){ao.preventDefault();al("header")}}});j.bind("touchclick",function(ap){var ao=Q("#stage").get(0);ao.width=ab.innerWidth;ao.height=ab.innerHeight;h.body.setAttribute("id","mode_draw");if(!o){init()}am.clear();am.reset();g(2);A(100);l.animate({top:-1*parseInt(l.getStyle("height"))},200,30);ai.show();aa="unsaved";x.show()});var K=function(aq){if(Q(this).hasClass("new")||!Q(this).hasClass("active")){return false}if(Q(this).hasClass("delete")){var at=this.getAttribute("data-id"),ap=this.getAttribute("data-source");if(ap=="local"){ab.localStorage.removeItem("image_"+at);ab.localStorage.removeItem("thumb_"+at);if(ab.localStorage.getItem("last_id")==at){var ao=this.nextElementSibling.getAttribute("data-id");ab.localStorage.setItem("last_id",ao)}F();if(Q("#home .grid .active:not(.new)").elements.length==0){ai.hide();ai.get(0).innerHTML="Edit";y.show();P.removeClass("delete")}}else{if(ap=="server"){Q.ajax({url:"../cloud-delete/",data:"user_id="+B+"&image_id="+at,type:"POST",success:function(){C(B,function(){F();if(Q("#home .grid .active:not(.new)").elements.length==0){ai.hide();ai.get(0).innerHTML="Edit";y.show();P.removeClass("delete")}})}})}}}else{h.body.setAttribute("id","mode_draw");if(!o){init()}l.animate({top:-1*parseInt(l.getStyle("height"))},200,30);ai.show();L("Loading image...","no-animation");if(this.getAttribute("data-source")=="local"){var at=this.getAttribute("data-id"),ar=ab.localStorage.getItem("image_"+at)}else{if(this.getAttribute("data-source")=="server"){var at=this.getAttribute("data-index"),ar=Z[at].fullsize}}am.clear();am.loadImage(ar,0,0,true,function(){ag()});aa="saved";N=at;x.hide()}};P.bind("touchclick",K);var ad=function(ao,ar,at,aq,ap){ap=ap||(ap==0?0:"");P.elements[ao].style.background=ar.length>0?"url('"+ar+"')":"";P.elements[ao].style.WebkitBackgroundClip="padding-box";if(ar.length>0){Q(P.elements[ao]).addClass("active")}else{Q(P.elements[ao]).removeClass("active")}P.elements[ao].setAttribute("data-id",at);P.elements[ao].setAttribute("data-index",ap);P.elements[ao].setAttribute("data-source",aq)};var u=function(ap,ar,ao){ao=ao||(ao==0?0:"");if(ai.hasClass("hidden")){ai.removeClass("hidden")}if(ap=="local"){var aq=ab.localStorage.getItem("thumb_"+ar);if(aq!==null&&~aq.indexOf("data:")){ad(r,aq,ar,ap);r++}}else{if(ap=="server"){ad(r,Z[ao].thumbnail,ar,ap,ao);r++}}},F=function(){if(Z.length>0){for(var ap=0,ao=Z.length;ap<ao;ap++){if(P.elements[r]===t){break}u("server",Z[ap].id,ap)}}var aq=~~ab.localStorage.getItem("last_id");for(var ar=aq;ar>0;ar--){if(P.elements[r]===t){break}u("local",ar)}for(var ap=r,ao=P.elements.length;ap<ao;ap++){ad(ap,"","","")}r=1};F()})(window,window.document,appHelp);